╔═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                            RAG CHATBOT QUERY FLOW DIAGRAM                                             ║
╚═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╝

                                                     FRONTEND
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│  User Interface (script.js)                                                                                           │
│                                                                                                                        │
│  [User] ──► [Input Field] ──► [Send Button]                                                                          │
│                                      │                                                                                │
│                                      ▼                                                                                │
│                           1. sendMessage() triggered                                                                  │
│                              - Disable input                                                                          │
│                              - Show loading animation                                                                 │
│                              - Store session_id                                                                       │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼ HTTP POST /api/query
                              { query: "...", session_id: "..." }
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                             BACKEND API LAYER                                                         │
│                                                                                                                        │
│  FastAPI Server (app.py)                                                                                             │
│  ┌─────────────────────────┐                                                                                          │
│  │  2. Validate Request    │ ──► QueryRequest Model                                                                  │
│  │     - query: str        │     { query, session_id }                                                               │
│  │     - session_id: str   │                                                                                          │
│  └─────────────────────────┘                                                                                          │
│                │                                                                                                       │
│                ▼                                                                                                       │
│  ┌─────────────────────────┐                                                                                          │
│  │  3. Create Session      │ ──► Generate new session_id if none provided                                           │
│  │     if needed           │                                                                                          │
│  └─────────────────────────┘                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼ rag_system.query(query, session_id)
                                      │
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                           RAG ORCHESTRATION LAYER                                                     │
│                                                                                                                        │
│  RAG System (rag_system.py)                                                                                          │
│  ┌─────────────────────────┐     ┌─────────────────────────┐     ┌─────────────────────────┐                        │
│  │  4. Get Conversation    │────►│  Session Manager        │────►│  conversation_history   │                        │
│  │     History             │     │  (session_manager.py)  │     │  ["Q1", "A1", "Q2"...] │                        │
│  └─────────────────────────┘     └─────────────────────────┘     └─────────────────────────┘                        │
│                │                                                                                                       │
│                ▼                                                                                                       │
│  ┌─────────────────────────┐                                                                                          │
│  │  5. Build Prompt        │ ──► "Answer this question about course materials: {query}"                             │
│  │                         │                                                                                          │
│  └─────────────────────────┘                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼ ai_generator.generate_response()
                                      │
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                             AI GENERATION LAYER                                                       │
│                                                                                                                        │
│  AI Generator (ai_generator.py)                                                                                       │
│  ┌─────────────────────────┐     ┌─────────────────────────┐                                                          │
│  │  6. System Prompt       │────►│  "You are an AI         │                                                          │
│  │     Configuration       │     │   assistant specialized │                                                          │
│  │                         │     │   in course materials..." │                                                         │
│  └─────────────────────────┘     └─────────────────────────┘                                                          │
│                │                                                                                                       │
│                ▼                                                                                                       │
│  ┌─────────────────────────┐                                                                                          │
│  │  7. Claude API Call     │ ──► Anthropic Claude API                                                                │
│  │     with Tools          │     - model: claude-3-sonnet                                                            │
│  │                         │     - temperature: 0                                                                     │
│  │                         │     - max_tokens: 800                                                                    │
│  │                         │     - tools: [CourseSearchTool]                                                         │
│  └─────────────────────────┘                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼ Claude decides to use search tool
                                      │
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                            SEARCH & RETRIEVAL LAYER                                                   │
│                                                                                                                        │
│  Tool Manager (search_tools.py)              Vector Store (vector_store.py)                                         │
│  ┌─────────────────────────┐                 ┌─────────────────────────┐                                              │
│  │  8. CourseSearchTool    │────────────────►│  9. ChromaDB Query      │                                              │
│  │     .search(query)      │                 │     similarity_search() │                                              │
│  └─────────────────────────┘                 └─────────────────────────┘                                              │
│                │                                              │                                                       │
│                │                                              ▼                                                       │
│                │                             ┌─────────────────────────┐                                              │
│                │                             │ 10. Retrieve Course     │                                              │
│                │                             │     Chunks with         │                                              │
│                │                             │     Embeddings          │                                              │
│                │                             └─────────────────────────┘                                              │
│                │                                              │                                                       │
│                ▼                                              ▼                                                       │
│  ┌─────────────────────────┐                 ┌─────────────────────────┐                                              │
│  │ 11. Collect Sources     │◄────────────────│ 12. Return Relevant     │                                              │
│  │     for Citations       │                 │     Content Chunks      │                                              │
│  └─────────────────────────┘                 └─────────────────────────┘                                              │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼ Search results returned to Claude
                                      │
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                           RESPONSE ASSEMBLY LAYER                                                     │
│                                                                                                                        │
│  ┌─────────────────────────┐     ┌─────────────────────────┐     ┌─────────────────────────┐                        │
│  │ 13. Claude Generates    │────►│ 14. RAG System         │────►│ 15. Session Manager     │                        │
│  │     Response using      │     │     Collects Sources   │     │     Updates History     │                        │
│  │     Search Results      │     │     get_last_sources() │     │     add_exchange()      │                        │
│  └─────────────────────────┘     └─────────────────────────┘     └─────────────────────────┘                        │
│                                                  │                                                                     │
│                                                  ▼                                                                     │
│                                  ┌─────────────────────────┐                                                          │
│                                  │ 16. Return Response     │                                                          │
│                                  │     { answer, sources,  │                                                          │
│                                  │       session_id }      │                                                          │
│                                  └─────────────────────────┘                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼ QueryResponse returned to API
                                      │
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                             FRONTEND RESPONSE                                                         │
│                                                                                                                        │
│  Frontend (script.js)                                                                                                │
│  ┌─────────────────────────┐     ┌─────────────────────────┐     ┌─────────────────────────┐                        │
│  │ 17. Receive JSON        │────►│ 18. Update Session ID  │────►│ 19. Display Response    │                        │
│  │     Response            │     │     if new              │     │     - Remove loading    │                        │
│  │                         │     │                         │     │     - Show AI answer    │                        │
│  └─────────────────────────┘     └─────────────────────────┘     │     - Show sources      │                        │
│                                                                   │     - Re-enable input   │                        │
│                                                                   └─────────────────────────┘                        │
│                                                                                   │                                    │
│                                                                                   ▼                                    │
│                                                  ┌─────────────────────────┐                                          │
│                                                  │ 20. User sees Response  │                                          │
│                                                  │     with Sources        │                                          │
│                                                  └─────────────────────────┘                                          │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

╔═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                                 KEY COMPONENTS                                                         ║
╠═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                                                        ║
║  📱 FRONTEND                   🔧 BACKEND PROCESSING              📚 DATA & SEARCH                                    ║
║  ────────────                 ──────────────────────             ─────────────────                                    ║
║  • User Interface             • FastAPI Server                   • ChromaDB Vector Store                              ║
║  • Session Management         • RAG System Orchestrator          • Course Document Processing                         ║
║  • HTTP Communication         • AI Generator (Claude API)        • Semantic Search                                    ║
║  • Response Rendering          • Session Manager                 • Source Citations                                   ║
║                                • Search Tools                                                                          ║
║                                                                                                                        ║
║  🔄 DATA FLOW SUMMARY                                                                                                  ║
║  ──────────────────                                                                                                   ║
║  User Query → Frontend → API → RAG System → Claude AI → Search Tools → Vector Store → Sources → Response → Display  ║
║                                                                                                                        ║
╚═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╝